/*! contextmenu - AndrewZhang - 25-01-2014 */
!function(a,b){var c='<a class="cm-btn {disabled}" data-cmd="{cmd}" href="{url}" target="{target}" title="{title}"><img src="{icon}" class="cm-btn-icon" alt=""><span class="cm-btn-text">{text}</span></a>',d='<li class="cm-item">'+c+"</li>",e='<li class="sep cm-item"></li>',f='<li class="cm-item has-menu">'+c+'<ul class="menu sub-menu ui-hidden">{submenu}</ul></li>',g="data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEHAAIALAAAAAABAAEAAAICVAEAOw==",h={icon:g,cmd:"unnamed-command",title:"",url:"javascript:",target:""},i=function(a,b){for(var c=/{([^}]+)?}/g;match=c.exec(a);)a=a.replace(match[0],b[match[1]]);return a},j=function(a){var c=[];return b.each(a,function(a,g){if("sep"==g)return c.push(e),!0;var k=b.extend({},h,g);k.disabled=k.disabled===!0?"cm-btn-disabled":"cm-btn-default",c.push(k.items&&k.items.length?i(f,b.extend(k,{submenu:j(k.items)})):i(d,k))}),c.join("")};a.ContextMenu=function(a){this.cfg=a,this._init()},ContextMenu.prototype={constructor:ContextMenu,_init:function(){this._initView(),this._initEvents()},_initView:function(){var a=this.cfg,c=[];c.push('<div class="ui-context-menu ui-hidden">'),c.push('<ul class="menu">'),c.push(j(a.items)),c.push("</ul>"),c.push("</div>"),this.$contextMenu=b(c.join("")).appendTo("body")},hide:function(){var a=this.$contextMenu;a.addClass("ui-hidden"),a.find("ul.sub-menu").addClass("ui-hidden")},_initEvents:function(){var a=this.cfg,c=this.$contextMenu,d=this;c.on("click","a[data-cmd]",function(){var c=b(this),e=c.parent(),f=this.getAttribute("data-cmd");return e.hasClass("has-menu")||c.hasClass("cm-btn-disabled")?!1:(d.hide(),void b.proxy(a.callback,d,f,a)())}),c.find(".has-menu").on("mouseenter mouseleave",function(a){var c=b(this),d=c.find("> a.cm-btn"),e=c.find("> ul.sub-menu"),f=c.width()-2;return d.hasClass("cm-btn-disabled")?!1:void("mouseenter"==a.type?e.removeClass("ui-hidden").css({left:f}):e.addClass("ui-hidden"))});var e=function(a){return a.preventDefault(),3==a.which&&c.css({left:a.pageX+"px",top:a.pageY+"px"}).removeClass("ui-hidden"),!1};a.selector?b("body").on("contextmenu",a.selector,e):b("body").on("contextmenu",e),b("body").on("click",function(a){var d=a.target;b.contains(c[0],d)||c.addClass("ui-hidden")})},updateItem:function(a,b){var c,d,e=this.$contextMenu.find('[data-cmd="'+a+'"]');if(e.length)for(c in b)switch(d=b[c],c){case"icon":e.find("> img.cm-btn-icon")[0].src=d;break;case"text":e.find("> span.cm-btn-text")[0].innerHTML=d;break;case"title":e.attr(c,d);break;case"url":e.attr("href",d);break;case"target":e.attr("target",d);break;case"cmd":e.attr("data-cmd",d);break;case"disabled":d?this.disableItem(a):this.enableItem(a)}},disableItem:function(a){var b=this.$contextMenu.find('[data-cmd="'+a+'"]');b.length&&b.removeClass("cm-btn-default cm-btn-active").addClass("cm-btn-disabled")},enableItem:function(a){var b=this.$contextMenu.find('[data-cmd="'+a+'"]');b.length&&b.removeClass("cm-btn-disabled cm-btn-active").addClass("cm-btn-default")},highlightItem:function(a){var b=this.$contextMenu,c=b.find("a.cm-btn-active"),d=b.find('[data-cmd="'+a+'"]');c.length&&c.removeClass("cm-btn-active").addClass("cm-btn-default"),d.length&&!d.hasClass("cm-btn-disabled")&&d.removeClass("cm-btn-default").addClass("cm-btn-active")},destroy:function(){this.$contextMenu.remove()}}}(this,jQuery);